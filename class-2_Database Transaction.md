# ЁЯТ╗What is Database Transaction. class 2

---

## ЁЯз╛ **Database Transaction (ржбрзЗржЯрж╛ржмрзЗрж╕ рж▓рзЗржиржжрзЗржи) ржХрзА?**

ржПржХржЯрж┐ **Transaction** рж╣рж▓ ржПржоржи ржПржХржЯрж┐ ржХрзНрж░рж┐рзЯрж╛ржХрж▓рж╛ржкрзЗрж░ рж╕рзЗржЯ ржпрж╛ ржбрзЗржЯрж╛ржмрзЗрж╕рзЗ ржПржХрж╕рж╛ржерзЗ рж╕ржорзНржкржирзНржи рж╣рзЯ тАФ рж╕ржорзНржкрзВрж░рзНржг ржирж╛ рж╣рж▓рзЗ ржХрж┐ржЫрзБржЗ рж╣рзЯ ржирж╛ред

ЁЯУМ ржЙржжрж╛рж╣рж░ржг:

ржПржХржЯрж┐ ржмрзНржпрж╛ржВржХ ржПржХрж╛ржЙржирзНржЯ ржерзЗржХрзЗ ржЯрж╛ржХрж╛ ржХрзЗржЯрзЗ ржЕржирзНржп ржПржХрж╛ржЙржирзНржЯрзЗ ржкрж╛ржарж╛ржирзЛ тАФ

- ржЯрж╛ржХрж╛ ржХрж╛ржЯрж╛ржУ тЬЕ
- ржЯрж╛ржХрж╛ ржЬржорж╛ржУ тЬЕ
- ржПржЗ ржжрзБржЗржЯрж╛ ржПржХрж╕рж╛ржерзЗ ржирж╛ рж╣рж▓рзЗ ржбрзЗржЯрж╛ **corrupt** рж╣рждрзЗ ржкрж╛рж░рзЗред

---

## ЁЯФД **Transaction Steps (рж▓рзЗржиржжрзЗржирзЗрж░ ржзрж╛ржкрж╕ржорзВрж╣)**

```
[BEGIN] тЮЬ [EXECUTE] тЮЬ [COMMIT or ROLLBACK]

```

| ржзрж╛ржк | ржмрж░рзНржгржирж╛ |
| --- | --- |
| `BEGIN` | рж▓рзЗржиржжрзЗржи рж╢рзБрж░рзБ |
| `EXECUTE` | ржПржХ ржмрж╛ ржПржХрж╛ржзрж┐ржХ ржЕржкрж╛рж░рзЗрж╢ржи (ржбрзЗржЯрж╛ржмрзЗрж╕рзЗ ржкрзЬрж╛/рж▓рзЗржЦрж╛) |
| `COMMIT` | рж╕ржм рж╕ржлрж▓ рж╣рж▓рзЗ рж╕рзНржерж╛рзЯрзАржнрж╛ржмрзЗ рж╕ржВрж░ржХрзНрж╖ржг |
| `ROLLBACK` | ржХрзЛржирзЛ рж╕ржорж╕рзНржпрж╛ рж╣рж▓рзЗ ржЖржЧрзЗрж░ ржЕржмрж╕рзНржерж╛рзЯ ржлрзЗрж░ржд |

---

## тЬЕ **ACID Properties of Transaction**

Transaction ржпрзЗржи ржирж┐рж░рзНржнрж░ржпрзЛржЧрзНржп рж╣рзЯ, рж╕рзЗржЬржирзНржп ржирж┐ржЪрзЗрж░ рзкржЯрж┐ ржирж┐рзЯржо ржорж╛ржирж╛ рж╣рзЯ:

| Property | ржмрж╛ржВрж▓рж╛ ржмрзНржпрж╛ржЦрзНржпрж╛ |
| --- | --- |
| **A - Atomicity** | рж╕ржм ржХрж╛ржЬ ржПржХрж╕рж╛ржерзЗ рж╣ржмрзЗ, ржирж╛ рж╣рж▓рзЗ ржХрж┐ржЫрзБржЗ рж╣ржмрзЗ ржирж╛ |
| **C - Consistency** | ржбрзЗржЯрж╛ржмрзЗрж╕рзЗрж░ ржирж┐рзЯржо ржнрж╛ржЩржмрзЗ ржирж╛ |
| **I - Isolation** | ржПржХрж╛ржзрж┐ржХ рж▓рзЗржиржжрзЗржи ржПржХрзЗ ржЕржкрж░ржХрзЗ ржкрзНрж░ржнрж╛ржмрж┐ржд ржХрж░ржмрзЗ ржирж╛ |
| **D - Durability** | ржПржХржмрж╛рж░ ржХржорж┐ржЯ рж╣рж▓рзЗ ржХрзЛржирзЛржнрж╛ржмрзЗржЗ ржорзБржЫрзЗ ржпрж╛ржмрзЗ ржирж╛ |

---

## ЁЯТ░ **Bank Example Diagram:**

```
User A: Account Balance = 500
User B: Account Balance = 300

Transaction:
1. A тЖТ B = 100 ржЯрж╛ржХрж╛ ржЯрзНрж░рж╛ржирзНрж╕ржлрж╛рж░

[BEGIN]
тЖТ A ржерзЗржХрзЗ 100 ржЯрж╛ржХрж╛ ржХрж╛ржЯрж▓
тЖТ B рждрзЗ 100 ржЯрж╛ржХрж╛ ржпрзЛржЧ ржХрж░рж▓
[COMMIT]

Final:
User A = 400
User B = 400

```

---

## ЁЯФН **Transaction States:**

```
[Active] тЮЬ [Partially Committed] тЮЬ [Committed]
             тмЛ
          [Failed] тЮЬ [Aborted]

```

| State | ржмрзНржпрж╛ржЦрзНржпрж╛ |
| --- | --- |
| **Active** | ржЯрзНрж░рж╛ржирзНрж╕рзНржпрж╛ржХрж╢ржи ржЪрж▓ржЫрзЗ |
| **Partially Committed** | рж╕ржм ржХрж╛ржЬ рж╢рзЗрж╖, ржХрж┐ржирзНрждрзБ ржПржЦржиржУ ржХржорж┐ржЯ рж╣рзЯржирж┐ |
| **Committed** | рж╕ржлрж▓ржнрж╛ржмрзЗ рж╕ржВрж░ржХрзНрж╖рж┐ржд |
| **Failed/Aborted** | рж╕ржорж╕рзНржпрж╛ рж╣рзЯрзЗржЫрзЗ, рждрж╛ржЗ рж░рзЛрж▓ржмрзНржпрж╛ржХ рж╣рзЯрзЗржЫрзЗ |

---

## тЪЩя╕П **System Design Context ржП ржХрзЗржи ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг?**

- Large scale system ржП consistency рж░ржХрзНрж╖рж╛ ржХрж░рждрзЗ ржжрж░ржХрж╛рж░
- Replication ржмрж╛ distributed system ржП ржПржХрж╛ржзрж┐ржХ ржбрзЗржЯрж╛ржмрзЗрж╕рзЗ ACID ржорж╛ржирж╛ ржЪрзНржпрж╛рж▓рзЗржЮрзНржЬрж┐ржВ
- Transaction fail рж╣рж▓рзЗ fallback strategy ржерж╛ржХрждрзЗ рж╣рзЯ (ржпрзЗржоржи: retry queue, event sourcing)

---

## ЁЯУж **Bonus: Replication ржУ High Traffic Management**

- **Replication:** ржПржХрж╛ржзрж┐ржХ рж╕рж╛рж░рзНржнрж╛рж░рзЗ ржбрзЗржЯрж╛ ржХржкрж┐ ржХрж░рзЗ рж░рж╛ржЦрж╛ рж╣рзЯ тЖТ Load balancing ржУ Fault tolerance
- **Eventual Consistency:** рж╕ржм ржбрзЗржЯрж╛ ржПржХрж╕рж╛ржерзЗ update рж╣ржмрзЗ ржирж╛, рждржмрзЗ рж╢рзЗрж╖ ржкрж░рзНржпржирзНржд consistent рж╣ржмрзЗ